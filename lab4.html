<!DOCTYPE HTML>
<meta charset="UTF-8">
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <script src="../RealTimeRenderingLab4/js/webgl-utils.js"></script>
    <script src="../RealTimeRenderingLab4/js/planetClass.js"></script>
    <script src="../RealTimeRenderingLab4/js/sunClass.js"></script>
    <script src="../RealTimeRenderingLab4/js/three.min.js"></script>
    <script src="../RealTimeRenderingLab4/js/OrbitControls.js"></script>

    <script id="vertex-shader" type="x-shader/x-vertex">

      attribute vec4 vPosition;
      attribute vec4 vNormal;
      varying vec4 fColor;

      uniform vec4 ambientProduct, diffuseProduct, specularProduct;
      uniform mat4 modelViewMatrix;
      uniform mat4 projectionMatrix;
      uniform vec4 lightPosition;
      uniform float shininess;
      uniform mat3 normalMatrix;

      void main(void)
      {
        vec3 pos = -(modelViewMatrix * vPosition).xyz;
        vec3 light = lightPosition.xyz;
        vec3 L = normalize( light - pos );

        vec3 E = normalize( -pos );
        vec3 H = normalize( L + E );
        // Transform vertex normal into eye coordinates
        vec3 N = normalize( normalMatrix*vNormal.xyz);
        // Compute terms in the illumination equation
        vec4 ambient = ambientProduct;

        float Kd = max( dot(L, N), 0.0 );
        vec4 diffuse = Kd*diffuseProduct;

        float Ks = pow( max(dot(N, H), 0.0), shininess );
        vec4 specular = Ks * specularProduct;

        if( dot(L, N) < 0.0 ) {
          specular = vec4(0.0, 0.0, 0.0, 1.0);
        }

        gl_Position = projectionMatrix * modelViewMatrix * vPosition;

        fColor = ambient + diffuse + specular;
        fColor.a = 1.0;
      }
    </script>

    <script id="fragment-shader" type="x-shader/x-fragment">

      precision mediump float;

      //varying vec4 fColor;

      void main(void)
      {
        gl_FragColor = (1,1,1,1);
      }
    </script>
    <script>

      var externalCanvas, renderer, camera, controls, scene, container, light, sun;

      init();
      render();

      function animate() {
        requestAnimationFrame(animate);
        controls.update();
        update();
      }

      function init() {
        // camera
        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1000, 10000);
        camera.position.z = 500;

        // controls
        controls = new THREE.OrbitControls(camera);
        controls.damping = 0.2;
        controls.addEventListener("change", render);

        // scene
        scene = new THREE.Scene();

      	light = new THREE.PointLight( 0xffffff, 1.0 );
       	light.position.set( 0,0,0);
      	scene.add(light);
        sun = new Sun(0xFF0000, 100);
        scene.add(sun.mesh);
        var planetMercury = new Planet("Murcury", 0xFF0000, 15, 359, 88, 0, sun);
        var planetVenus = new Planet("Venus", 0xFF9900, 38, 672, 225, 0, sun);
        var planetEarth = new Planet("Earth", 0x009944, 40, 929, 365, 0, sun);
        var planetMars = new Planet("Mars", 0xFF1111, 21, 1416, 687, 0, sun);
        sun.AddChild(planetMercury);
        sun.AddChild(planetVenus);
        sun.AddChild(planetEarth);
        sun.AddChild(planetMars);

        scene.add(planetMercury.mesh);
        scene.add(planetVenus.mesh);
        scene.add(planetEarth.mesh);
        scene.add(planetMars.mesh);

        // renderer
        renderer = new THREE.WebGLRenderer({ antialias: false });
        renderer.setSize(window.innerWidth, window.innerHeight);

        container = document.getElementById('container');
        container.appendChild(renderer.domElement);

        animate();
      }

      function render() {
        renderer.render(scene, camera);
      }

      function update(){
        sun.Update();
      }
    </script>
  </body>
</html>
